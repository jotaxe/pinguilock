(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{110:function(e,t,n){e.exports=n(285)},115:function(e,t,n){},117:function(e,t,n){},169:function(e,t){},285:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(32),c=n.n(r),i=(n(115),n(12)),s=n(13),l=n(16),u=n(14),d=n(17),p=n(30),m=n(60),h=n.n(m),g=n(61),f=n.n(g),v=n(11),b=n.n(v),O=(n(117),n(288)),w=n(287),y=n(119),k=n(135),E=n(142),S=n(172),j=E("http://ec2-18-191-188-122.us-east-2.compute.amazonaws.com:3030"),x=y();x.configure(k(j)),x.configure(S({storage:localStorage,storageKey:"accessToken"}));var C=x,I=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){this.props.classes;return o.a.createElement("div",null,o.a.createElement(b.a,{align:"center",component:"h2",variant:"h1",gutterBottom:!0},"Welcome to Ping\xfcilock"))}}]),t}(a.Component),T=Object(p.withStyles)({root:{flexGrow:1}})(I),q=n(62),U=n.n(q),N=n(104),P=n(105),R=n.n(P),_=n(106),B=n.n(_),W=n(108),A=n.n(W),Q=n(107),V=n.n(Q),G=function(e){function t(e){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.classes,t=this.props;return o.a.createElement(B.a,{className:e.card},o.a.createElement(V.a,null,o.a.createElement(b.a,{align:"center",className:e.title,color:"textSecondary",gutterBottom:!0},t.title),o.a.createElement("div",{className:e.content},"incorrect"!==this.props.content?this.props.content:o.a.createElement(b.a,{align:"center",className:e.title,color:"textSecondary"},"Incorrect User. You can't see this QR Code.")),o.a.createElement(b.a,{align:"center",className:e.pos,color:"textSecondary"},t.secondary)),o.a.createElement(A.a,null,this.props.button))}}]),t}(a.Component),J=Object(p.withStyles)({card:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12},content:{textAlign:"center"}})(G),z=n(33),L=n.n(z),D=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=Object(N.a)(U.a.mark(function e(){var t,a,o,r,c;return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.props.match.params.otp,a=localStorage.getItem("accessToken"),C.service("otp").on("patched",function(e){n.setState({otp:e})}),!a){e.next=17;break}return e.next=6,C.authenticate();case 6:return o=e.sent,localStorage.setItem("user",JSON.stringify(o.user)),e.next=10,C.service("otp").get(t);case 10:return r=e.sent,e.next=13,C.service("user").get(r.granted_by_user);case 13:c=e.sent,r.user_id?r.user_id===o.user.id?n.setState({qrView:"correctUser",otp:r,grantedBy:c.name}):n.setState({qrView:"incorrectUser"}):n.setState({qrView:"linkUser"}),e.next=18;break;case 17:n.setState({qrView:"login"});case 18:case"end":return e.stop()}},e,this)})),n.linkAccount=function(){var e=n.state.otpId;C.authenticate().then(function(t){C.service("otp").patch(e,{user_id:t.user.id,status:"aproval pending"}).then(function(){alert("User linked! please wait for aproval.")})})},n.loginAction=function(){window.location.href="http://localhost:3030/auth/google"},n.sendRequest=function(){var e=n.state.otp,t=JSON.parse(localStorage.getItem("user"));C.service("access-request").create({user_id:t.id,lock_id:e.lock_id,otp_id:e.id,method:"OTP"}).then(function(){n.setState({requestSended:!0})})},localStorage.setItem("otpId",n.props.match.params.otp),n.state={otpId:n.props.match.params.otp,qrView:void 0,otp:void 0,requestSended:!1,grantedBy:""},n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.state,t=e.qrView,n=e.otp,a={card:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12}};switch(console.log(t),t){case"correctUser":var r=this.state,c=r.requestSended,i=r.grantedBy,s="active"===n.status?o.a.createElement(R.a,{renderAs:"svg",size:"300",value:n.secret_code}):"timedout"==n.status?o.a.createElement(b.a,{align:"center",className:a.title,color:"textSecondary"},"OTP Timedout."):o.a.createElement(b.a,{align:"center",className:a.title,color:"textSecondary"},"please wait for aproval from admin.");return o.a.createElement(J,{title:"One Time Password QR Code",secondary:"Granted by user: ".concat(i),content:s,button:c&&"active"===n.status?null:o.a.createElement(L.a,{onClick:this.sendRequest}," Use OTP ")});case"incorrectUser":return o.a.createElement(J,{title:"One Time Password QR Code",secondary:"WRONG USER",content:"incorrect"});case"linkUser":var l=JSON.parse(localStorage.getItem("user"));return o.a.createElement(J,{title:"One Time Password QR Code",secondary:"would you like to link this account (".concat(l.email,") with this OTP?"),button:o.a.createElement(L.a,{onClick:this.linkAccount}," Link account ")});case"login":return o.a.createElement(J,{title:"One Time Password QR Code",secondary:"Login",content:o.a.createElement(L.a,{onClick:this.loginAction}," Login With Google ")});default:return o.a.createElement("div",null,"Loading")}}}]),t}(a.Component);var M=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var a=t[n].split("=");if(decodeURIComponent(a[0])==e)return decodeURIComponent(a[1])}console.log("Query variable %s not found",e)}("token");e&&localStorage.setItem("accessToken",e);var t=localStorage.getItem("otpId");t?this.props.history.push("/assingOTP/".concat(t)):this.props.history.push("/")}},{key:"render",value:function(){return o.a.createElement("div",null,"redirecting... please wait")}}]),t}(a.Component),K=o.a.createElement(O.a,null,o.a.createElement(w.a,{exact:!0,path:"/",component:T}),o.a.createElement(w.a,{path:"/assingOtp/:otp?",component:D}),o.a.createElement(w.a,{path:"/redirect",component:M})),Y=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(h.a,{position:"static",color:"default"},o.a.createElement(f.a,null,o.a.createElement(b.a,{variant:"h6",color:"inherit"},"Ping\xfcilock"))),K)}}]),t}(a.Component),$=Object(p.withStyles)({root:{flexGrow:1}})(Y);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var F=n(286);c.a.render(o.a.createElement(F.a,null,o.a.createElement($,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[110,2,1]]]);
//# sourceMappingURL=main.12fd0444.chunk.js.map